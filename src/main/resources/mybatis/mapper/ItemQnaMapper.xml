<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-/mabatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.exe.cozy.mapper.ItemQnaMapper">

	<!--새 문의 번호 -->
	<select id="itemQnaMaxNum" resultType="int">		
		select nvl(max(itemQnaNum),0)
		from itemQna	
	</select>

	<!-- 문의등록 -->
	<insert id="insertItemQna" parameterType="ItemQnaDto">		
		insert into itemQna(itemQnaNum, itemNum, itemQnaTitle, ItemQnaCreate ,itemQnaContent,customerEmail)
		values(#{itemQnaNum}, #{itemNum}, #{itemQnaTitle},sysdate, #{itemQnaContent}, #{customerEmail})	
	</insert>

	<!-- 문의확인 -->
	<select id="findItemQna" parameterType="int" resultType="ItemQnaDto">	
		select * from itemQna
		where itemQnaNum = #{itemQnaNum}
	</select>

	<!--ItemNum 으로 읽기 -->
	<select id="getReadItemQnaData" parameterType="int" resultType="ItemQnaDto">
		select itemQnaNum, itemNum, itemQnaTitle, ItemQnaCreate, itemQnacontent from itemQna
		where itemNum=#{itemNum}
	</select>
	
	
	<resultMap type="ItemQnaDto" id="ItemQnaDto">
		<result column="itemQnaNum" property="itemQnaNum" />
		<result column="itemNum" property="itemNum" />
		<result column="itemQnaTitle" property="itemQnaTitle" />
		<result column="customerEmail" property="customerEmail" />
		<result column="ItemQnaCreate" property="ItemQnaCreate" />
		<result column="itemQnaContent" property="itemQnaContent" />
		
		<collection property="answer" resultMap="QnaAnswerDto"></collection>
	</resultMap>
	
	<resultMap type="QnaAnswerDto" id="QnaAnswerDto">
		<result column="qnaAnswerNum" property="qnaAnswerNum" />
		<result column="itemQnaNum" property="itemQnaNum" />
		<result column="answerCreate" property="answerCreate" />
		<result column="qnaContent" property="qnaContent" />
	</resultMap>
	

	
	<select id="getReadQnaList" parameterType="ItemQnaDto" resultMap="ItemQnaDto">
	select 
	a.itemQnaNum ,
	a.itemNum, 
	a.itemQnaTitle,
	a.customerEmail,
	a.ItemQnaCreate,
	a.itemQnaContent, 
	 b.qnaAnswerNum, 
	 b.answerCreate, 
	 b.qnaContent
	FROM ITEMQNA a left join qnaAnswer b 
	on a.itemQnaNum =b.itemQnaNum 
	WHERE a.itemNum =#{itemNum} 
	order by itemQnaNum desc
	</select>


	<!-- 문의수정 -->
	<update id="updateItemQna" parameterType="ItemQnaDto">
		update itemQna set itemQnaContent=#{itemQnaContent},ItemQnaCreate= sysdate where
		itemQnaNum=#{itemQnaNum}
	</update>

	<!-- 문의삭제 -->
	<delete id="deleteItemQna" parameterType="int">
		delete itemQna where
		itemQnaNum=#{itemQnaNum}
	</delete>

</mapper>